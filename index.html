<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>音楽コード役割アナライザー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", "Noto Sans JP", sans-serif;
        -webkit-tap-highlight-color: transparent;
      }
      /* カスタムスタイル */
      .tonic {
        background-color: #e0f2fe;
        border-color: #38bdf8;
      }
      .subdominant {
        background-color: #ecfdf5;
        border-color: #34d399;
      }
      .dominant {
        background-color: #fff1f2;
        border-color: #fb7185;
      }

      .tonic-text {
        color: #0c4a6e;
      }
      .subdominant-text {
        color: #065f46;
      }
      .dominant-text {
        color: #9f1239;
      }

      .tonic-border {
        border-left-color: #38bdf8;
      }
      .subdominant-border {
        border-left-color: #34d399;
      }
      .dominant-border {
        border-left-color: #fb7185;
      }

      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.5rem center;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800">
    <div id="app" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
      <!-- Header -->
      <header class="text-center mb-6">
        <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">
          コード役割アナライザー
        </h1>
        <p class="mt-2 text-slate-600">
          選択したキーのダイアトニックコードと役割を表示します。
        </p>
      </header>

      <!-- Controls -->
      <div
        class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-8 sticky top-4 z-10"
      >
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label
              for="key-select"
              class="block text-sm font-medium text-slate-700 mb-1"
              >キー</label
            >
            <select
              id="key-select"
              class="w-full bg-slate-100 border-2 border-slate-200 rounded-lg p-3 text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
            >
              <!-- Options will be generated by JS -->
            </select>
          </div>
          <div>
            <label
              for="scale-select"
              class="block text-sm font-medium text-slate-700 mb-1"
              >スケール</label
            >
            <select
              id="scale-select"
              class="w-full bg-slate-100 border-2 border-slate-200 rounded-lg p-3 text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
            >
              <option value="major">メジャー</option>
              <option value="minor">マイナー</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Pentatonic Scale Display -->
      <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-8">
        <h2 class="text-xl font-semibold text-slate-800 mb-4">
          ペンタトニックスケール
        </h2>
        <div id="pentatonic-scale-container" class="flex flex-wrap gap-3">
          <!-- Scale notes will be generated by JS -->
        </div>
      </div>

      <!-- Chord Display -->
      <main>
        <div
          id="chord-container"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6"
        >
          <!-- Chord cards will be generated by JS -->
        </div>
      </main>

      <!-- Footer -->
      <footer class="text-center mt-12 text-slate-500 text-sm">
        <p>&copy; 2024 Diatonic Chord Analyzer</p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const keySelect = document.getElementById("key-select");
        const scaleSelect = document.getElementById("scale-select");
        const chordContainer = document.getElementById("chord-container");
        const pentatonicContainer = document.getElementById(
          "pentatonic-scale-container"
        ); // 追加

        const NOTES = [
          { value: "C", name: "C" },
          { value: "C#", name: "C# / D♭" },
          { value: "D", name: "D" },
          { value: "D#", name: "D# / E♭" },
          { value: "E", name: "E" },
          { value: "F", name: "F" },
          { value: "F#", name: "F# / G♭" },
          { value: "G", name: "G" },
          { value: "G#", name: "G# / A♭" },
          { value: "A", name: "A" },
          { value: "A#", name: "A# / B♭" },
          { value: "B", name: "B" },
        ];

        const ALL_NOTES = [
          "C",
          "C#",
          "D",
          "D#",
          "E",
          "F",
          "F#",
          "G",
          "G#",
          "A",
          "A#",
          "B",
        ];

        const SCALES = {
          major: {
            intervals: [0, 2, 4, 5, 7, 9, 11],
            pentatonicIntervals: [0, 2, 4, 7, 9], // Major Pentatonic (1, 2, 3, 5, 6)
            qualities: [
              "major",
              "minor",
              "minor",
              "major",
              "major",
              "minor",
              "diminished",
            ],
            roman: ["I", "ii", "iii", "IV", "V", "vi", "vii°"],
            functions: [
              { name: "トニック", type: "tonic", description: "安定・終止" },
              {
                name: "サブドミナント・マイナー",
                type: "subdominant",
                description: "SDの代理",
              },
              {
                name: "トニック・マイナー",
                type: "tonic",
                description: "Tの代理",
              },
              {
                name: "サブドミナント",
                type: "subdominant",
                description: "展開・発展",
              },
              {
                name: "ドミナント",
                type: "dominant",
                description: "緊張・解決へ",
              },
              {
                name: "トニック・マイナー",
                type: "tonic",
                description: "Tの代理 (最重要)",
              },
              { name: "ドミナント", type: "dominant", description: "Dの代理" },
            ],
          },
          minor: {
            // Natural Minor
            intervals: [0, 2, 3, 5, 7, 8, 10],
            pentatonicIntervals: [0, 3, 5, 7, 10], // Minor Pentatonic (1, b3, 4, 5, b7)
            qualities: [
              "minor",
              "diminished",
              "major",
              "minor",
              "minor",
              "major",
              "major",
            ],
            roman: ["i", "ii°", "III", "iv", "v", "VI", "VII"],
            functions: [
              {
                name: "トニック・マイナー",
                type: "tonic",
                description: "安定・終止",
              },
              {
                name: "サブドミナント・マイナー",
                type: "subdominant",
                description: "SDの代理",
              },
              { name: "トニック", type: "tonic", description: "Tの代理" },
              {
                name: "サブドミナント・マイナー",
                type: "subdominant",
                description: "展開・発展",
              },
              {
                name: "ドミナント・マイナー",
                type: "dominant",
                description: "緊張 (弱)",
              },
              {
                name: "サブドミナント",
                type: "subdominant",
                description: "SDの代理",
              },
              {
                name: "サブドミナント",
                type: "subdominant",
                description: "SDの代理",
              },
            ],
          },
        };

        // --- ここからが復元されたコードです ---

        function init() {
          // Populate key select options
          NOTES.forEach((note) => {
            const option = document.createElement("option");
            option.value = note.value;
            option.textContent = note.name;
            keySelect.appendChild(option);
          });

          // Set default values and generate initial chords
          keySelect.value = "C";
          scaleSelect.value = "major";
          generateChords();

          // Add event listeners
          keySelect.addEventListener("change", generateChords);
          scaleSelect.addEventListener("change", generateChords);
        }

        function getNoteName(noteIndex) {
          return ALL_NOTES[noteIndex % 12];
        }

        function getChordName(rootNote, quality) {
          switch (quality) {
            case "major":
              return rootNote;
            case "minor":
              return `${rootNote}m`;
            case "diminished":
              return `${rootNote}dim`;
            default:
              return rootNote;
          }
        }

        function generateChords() {
          const selectedKey = keySelect.value;
          const selectedScale = scaleSelect.value;
          const rootIndex = ALL_NOTES.indexOf(selectedKey);
          const scaleInfo = SCALES[selectedScale];

          chordContainer.innerHTML = ""; // Clear previous chords
          pentatonicContainer.innerHTML = ""; // Clear previous scale notes

          // Generate and display Chord cards
          scaleInfo.intervals.forEach((interval, index) => {
            const noteIndex = rootIndex + interval;
            const rootNote = getNoteName(noteIndex);
            const quality = scaleInfo.qualities[index];
            const chordName = getChordName(rootNote, quality);
            const romanNumeral = scaleInfo.roman[index];
            const func = scaleInfo.functions[index];

            const card = `
                        <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300 border-l-8 ${func.type}-border">
                            <div class="p-5">
                                <div class="flex justify-between items-baseline">
                                    <span class="text-3xl font-bold ${func.type}-text">${chordName}</span>
                                    <span class="text-xl font-semibold text-slate-400">${romanNumeral}</span>
                                </div>
                                <div class="mt-3">
                                    <p class="text-lg font-semibold ${func.type}-text">${func.name}</p>
                                    <p class="text-slate-500 text-sm">${func.description}</p>
                                </div>
                            </div>
                            <div class="px-5 py-2 ${func.type} bg-opacity-70">
                                <p class="text-xs font-bold uppercase ${func.type}-text tracking-wider">${func.type}</p>
                            </div>
                        </div>
                    `;
            chordContainer.innerHTML += card;
          });

          // Generate and display pentatonic scale
          if (scaleInfo.pentatonicIntervals) {
            scaleInfo.pentatonicIntervals.forEach((interval) => {
              const noteIndex = rootIndex + interval;
              const noteName = getNoteName(noteIndex);

              const noteChip = document.createElement("span");
              noteChip.className =
                "px-4 py-2 bg-sky-100 text-sky-800 text-lg font-semibold rounded-full shadow-sm";
              noteChip.textContent = noteName;
              pentatonicContainer.appendChild(noteChip);
            });
          }
        }

        init();
      }); // <-- 修正点: 不足していた閉じカッコを補完しました
    </script>
  </body>
</html>
